@using BusinessData.ofAccount.ofModel
@using BusinessData.ofCommon.ofInterface
@using BusinessLogic.ofManager.ofGeneric
@using System.Reflection
@using System.ComponentModel.DataAnnotations
@typeparam TEntity where TEntity : Entity, IRelationable, ITablable, new();
@inject IEntityManager<TEntity> EntityManager
<MudDialog>
    <DialogContent>
        <MudForm @ref="form" @bind-IsValid="@success" @bind-Errors="@errors">
                <MudTextField T="string"  @bind-Value="BusinessUser.Name" Label="사업자명" Required="true" RequiredError="필수 값입니다!"/>
                <MudTextField T="string" @bind-Value="BusinessUser.BusinessName" Label="사업장명" Required="true" RequiredError="필수 값입니다!"/>
                <MudTextField T="string" @bind-Value="BusinessUser.RegisterNumber" Label="사업자등록번호" Required="true" RequiredError="필수 값입니다!"/>
                <MudTextField T="string" @bind-Value="BusinessUser.BusinessSector" Label="업태" Required="true" RequiredError="필수 값입니다!"/>
                <MudTextField T="string" @bind-Value="BusinessUser.BusinssType" Label="종목" Required="true" RequiredError="필수 값입니다!"/>
                <MudTextField T="string" @bind-Value="BusinessUser.Email" Label="Email" Required="true" RequiredError="필수 값입니다!"
                                  Validation="@(new EmailAddressAttribute() {ErrorMessage = "The email address is invalid"})"/>                  
        </MudForm>   
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" DisableElevation="true" OnClick="@(()=>form.Validate())">Validate</MudButton>
            <MudButton Variant="Variant.Filled" Color="Color.Secondary" DisableElevation="true" OnClick="@(()=>form.Reset())" Class="mx-2">Reset</MudButton>
            <MudButton Variant="Variant.Filled" DisableElevation="true" OnClick="@(()=>form.ResetValidation())">Reset Validation</MudButton>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="CreateAsync">Create</MudButton>
    </DialogActions>
</MudDialog>
@code
{
    [CascadingParameter] public MudDialogInstance MudDialog { get; set; }
    void Submit() => MudDialog.Close(DialogResult.Ok(true));
    void Cancel() => MudDialog.Cancel();
    bool success;
    string[] errors = { };
    MudTextField<string> pwField1;
    MudForm form;
    public BusinessUser BusinessUser = new();
    [Parameter] public List<TEntity> Entities {get; set;}
    public PropertyInfo[] PropertyInfos = new PropertyInfo[20];
    public TEntity Entity = new();
    protected override async Task OnInitializedAsync()
    {
        PropertyInfos = typeof(TEntity).GetProperties();
    }
    public async Task CreateAsync()
    {
        var NewEntity = await EntityManager.CreateAsync(Entity);
        Entities.Add(NewEntity);
        StateHasChanged(); // 이걸로 커버가 안되면 NavigateTo를 사용해야지.
    }
}