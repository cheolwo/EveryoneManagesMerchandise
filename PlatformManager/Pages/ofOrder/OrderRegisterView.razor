@using BusinessData.ofAccount.ofModel
@using BusinessData.ofOrder.ofModel
@using BusinessData.ofWarehouse.Model
@using BusinessLogic.ofManager.ofGeneric
@using PlatformManager.ofComponent.ofBusinessUser
@using PlatformManager.ofComponent.ofOrder
@using PlatformManager.ofComponent.ofOrder.ofSOCommodity
@using PlatformManager.ofComponent.ofWarehouse
@using PlatformManager.ofComponent.ofTest
@inject IDialogService DialogService
@inject NavigationManager _NavigationManager
@inject IEntityManager<BusinessUser> _BusinessUserManager
@inject IEntityManager<Warehouse> _WarehouseManager

@page "/Register/Order"
<MudButton @onclick="OpenDialog" Variant="Variant.Filled" Color="Color.Primary">사업자등록 </MudButton>
@if(BusinessUser != null)
{
	@BusinessUser.Name;
}
<BusinessUserGetByBusinessCode EventSearchBusinessUserByNumber="SearchBusinessUserByNumber"></BusinessUserGetByBusinessCode>
<UserComponent>
	@if (IsSelectedSOCommodity)
	{
		<MudTextField @bind-Value="SOCommodity.Quantity" Label="Outlined" Variant="Variant.Outlined">수량</MudTextField>
		<MudTextField @bind-Value="SOCommodity.Price" Label="Outlined" Variant="Variant.Outlined">가격</MudTextField>
	}
	else
	{
	}
	@if (IsSelectedWarehouse)
	{
		<MudTextField @bind-Value="Warehouse.Name" Label="Outlined" Variant="Variant.Outlined">창고이름</MudTextField>
	}
	else
	{
		<SOCommodityTableComponent SelectedSOcommodity=SelectSOCommodity></SOCommodityTableComponent>
		<WareohuseTableComponent SelectWarehouse=SelectWarehouse></WareohuseTableComponent>
		<EntityTableComponent TEntity=Warehouse>/<EntityTableComponent>
		<EntityTableComponent TEntity=SOCommodity>/<EntityTableComponent>
	}
</UserComponent>
<MudButton Variant="Variant.Filled" Color="Color.Primary">뒤로</MudButton>
<MudButton Variant="Variant.Filled" Color="Color.Primary">등록</MudButton>
@*<EntityTableComponent TEntity=Warehouse TEntities=Warehouses CreateAsync=CreateWarehouse></EntityTableComponent>*@

@code {
	public BusinessUser BusinessUser { get; set; }
	public bool IsSelectedSOCommodity { get; set; }
	public bool IsSelectedWarehouse { get; set; }
	public Warehouse Warehouse { get; set; }
	public SOCommodity SOCommodity { get; set; }
	public List<Warehouse> Warehouses { get; set; }
	protected override void OnInitialized()
	{
		base.OnInitialized();
		Warehouse = new();
		Warehouses = new();
		BusinessUser = new();
		SOCommodity = new();
		IsSelectedSOCommodity = false;
		IsSelectedWarehouse = false;
		Warehouses.Add(new Warehouse());
		Warehouses.Add(new Warehouse());
		Warehouses.Add(new Warehouse());
	}
	public async Task CreateWarehouse(Warehouse warehouse)
	{
		await _WarehouseManager.CreateAsync(warehouse);
	}
	public async Task SearchBusinessUserByNumber(string businessNumber)
	{
		BusinessUser = await _BusinessUserManager.GetByCodeAsync(businessNumber);
	}
	public async Task CreateBusinessUserAsync(BusinessUser businessUser)
	{
		BusinessUser = await _BusinessUserManager.CreateAsync(businessUser);
	}
	public void SelectWarehouse(Warehouse warehouse)
	{
		Warehouse = warehouse;
		IsSelectedWarehouse = true;
	}
	public void SelectSOCommodity(SOCommodity soCommodity)
	{
		SOCommodity.CenterId = soCommodity.CenterId;
		SOCommodity.CommodityId = soCommodity.CommodityId;
		SOCommodity.Incorterms = soCommodity.Incorterms;
		SOCommodity.Quantity = soCommodity.Quantity;
		SOCommodity.QualityTerms = soCommodity.QualityTerms;
		SOCommodity.Price = soCommodity.Price;
		SOCommodity.Name = soCommodity.Name;
		SOCommodity.UserId = soCommodity.UserId;
		IsSelectedSOCommodity = true;
	}
	private void OpenCreateDialog()
	{
		var options = new DialogOptions { CloseOnEscapeKey = true };
		DialogService.Show<BusinessUserCreateByDialog>("사업자등록", options);
	}
}
